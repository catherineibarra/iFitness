var autocomplete;
jQuery(function ($) {
    var fn = {
        initializeAutocomplete: function (autocomplete, id) {
            var element = document.getElementById(id);
            if (element) {
                autocomplete = new google.maps.places.Autocomplete(element, {types: ['geocode']});
                autocomplete.setComponentRestrictions({'country': [ 'nz' ]});
                fn.placeAutoComplete(autocomplete, id);
            }
        },
        placeAutoComplete: function (autocomplete, id) {
            google.maps.event.addListener(autocomplete, 'place_changed', function () {
                var place = this.getPlace();
                var componentForm = {
                    street_number: 'short_name',
                    route: 'long_name',
                    sublocality_level_1: 'long_name',
                    locality: 'long_name',
                    administrative_area_level_1: 'long_name',
                    country: 'long_name',
                    postal_code: 'short_name'
                };

                var info = {};
                for (var i = 0; i < place.address_components.length; i++) {
                    var addressType = place.address_components[i].types[0];
                    if (componentForm[addressType]) {
                        info[addressType] = place.address_components[i][componentForm[addressType]];
                    }
                }
                var street = info.street_number + ' ' + info.route;
				/*
                if ( info.sublocality_level_1 != '' && info.sublocality_level_1 != null ) {
                    street += ', ' + info.sublocality_level_1;
                }
                if ( info.locality != '' && info.locality != null ) {
                    street += ', ' + info.locality;
                }
				*/
				var city = '';
				if ( info.sublocality_level_1 != '' && info.sublocality_level_1 != null ) {
                    city = info.sublocality_level_1;
                } else {
                    city = info.locality;
                }
				var regions = {
					'NL': 'Northland',
					'AK': 'Auckland',
					'WA': 'Waikato',
					'BP': 'Bay of Plenty',
					'TK': 'Taranaki',
					'GI': 'Gisborne',
					'HB': 'Hawkeâ€™s Bay',
					'MW': 'Manawatu-Wanganui',
					'WE': 'Wellington',
					'NS': 'Nelson',
					'MB': 'Marlborough',
					'TM': 'Tasman',
					'WC': 'West Coast',
					'CT': 'Canterbury',
					'OT': 'Otago',
					'SL': 'Southland'
				}
				var state = '';
				for (var short_name_region in regions) {
					if (info.administrative_area_level_1 == regions[short_name_region]) {
						state = short_name_region;
						break;
					}
				}
				jQuery('#billing_state').val(state).trigger('change');
                jQuery( '#billing_address_1' ).val( street );
                jQuery( '#billing_city' ).val( city );
                jQuery( '#billing_postcode' ).val( info.postal_code );
				jQuery( '#billing_postcode' ).trigger('change');
            });
        }
    };
    $(document).ready(function () {
        var autocomplete = [];
        fn.initializeAutocomplete(autocomplete, 'billing_address_1');
    });
});